$("#contact-form").submit(function(event) {
    event.preventDefault();  // Prevent default form submission

    // Check for any validation errors
    if ($(".contact__input").hasClass("mage-error")) {
        $(".contact__input.mage-error").each(function() {
            $(this).closest(".contact__section").addClass("contact__section--error");
        });
    }

    // If the form is valid, proceed with AJAX submission
    if ($("#contact-form").valid()) {
        // Disable submit button to prevent multiple submissions
        var submitButton = $(this).find('button[type=submit]');
        submitButton.attr('disabled', 'disabled').addClass('disabled');

        // Get GACLIENTID if available
        if (typeof ga != 'undefined' && ga && ga.getAll() && ga.getAll().length) {
            var tracker = ga.getAll()[0];
            var clientId = tracker.get('clientId');
            $('#GACLIENTID').val(clientId);
        }

        // Hash the email using SHA-256
        function sha256(message) {
            const encoder = new TextEncoder();
            const data = encoder.encode(message);
            return crypto.subtle.digest('SHA-256', data).then(hash => {
                return Array.from(new Uint8Array(hash))
                    .map(b => b.toString(16).padStart(2, '0'))
                    .join('');
            });
        }

        var emailValue = $("#email").val();
        sha256(emailValue).then(hash => {
            // Push data to Google Tag Manager
            window.dataLayer = window.dataLayer || [];
            window.dataLayer.push({
                'event': 'user_provided_data',
                'sha256_email_address': hash
            });
            window.dataLayer.push({
                'event': 'contactusFormSubmission'
            });

            // Serialize form data and send it via AJAX
            var formData = $("#contact-form").serialize();
            $.ajax({
                url: '<?php /* @escapeNotVerified */ echo $block->getFormAction(); ?>',
                type: 'POST',
                data: formData,
                success: function(response) {
                    // Show success or error overlay based on response
                    if (response.status === "success") {
                        // Reset form fields without triggering a submit
                        $("#contact-form")[0].reset();
                        $(".overlay-new-success").css("display", "block");
                    } else {
                        $(".overlay-new-error").css("display", "block");
                    }
                    // Re-enable submit button
                    submitButton.removeClass('disabled').removeAttr('disabled');
                },
                error: function(xhr, status, error) {
                    // Show error overlay and re-enable submit button on failure
                    $(".overlay-new-error").css("display", "block");
                    submitButton.removeClass('disabled').removeAttr('disabled');
                }
            });
        });
    } else {
        // Re-enable submit button if validation fails
        $(this).find('button[type=submit]').removeClass('disabled').removeAttr('disabled');
    }
});




function submitForm() {
    $.ajax({
        url: '/path/to/your/controller', // Replace with actual controller URL
        type: 'POST',
        data: $("#contact-form").serialize(), // Collects form data
        dataType: 'json',
        success: function(response) {
            if (response.status === 'success') {
                console.log("Form submitted successfully");

                // Manually clear each form field without using form.reset()
                $("#contact-form").find("input[type=text], input[type=email], textarea").val("");
                $("#contact-form").find("select").prop("selectedIndex", 0);
                $("#contact-form").find("input[type=checkbox]").prop("checked", false);

                // Re-enable the submit button
                $(".contact__button").removeClass('disabled').removeAttr('disabled');
            } else {
                console.log("Unexpected response status: " + response.status);
            }
        },
        error: function(xhr, status, error) {
            console.error("Form submission failed: " + error);

            // Re-enable the submit button in case of error
            $(".contact__button").removeClass('disabled').removeAttr('disabled');
        }
    });
}
