<?php
/**
 * Copyright Â© Magento, Inc. All rights reserved.
 * See COPYING.txt for license details.
 */

// phpcs:disable Magento2.Templates.ThisInTemplate

/** @var $block \Magento\Sales\Block\Order\Email\Items\DefaultItems */

/** @var $_item \Magento\Sales\Model\Order\Item */
$_item = $block->getItem();
$_order = $_item->getOrder();
$generalHelper = $this->helper('Jellyfish\General\Helper\Data');
$isSpainStore = $generalHelper->isEsStore();
$isFranceStore = $generalHelper->isFrStore();
$isEsSpainStore = $generalHelper->isEsSpainStore();
$isGermanyStore = $generalHelper->isDeStore();
$helper = $this->helper('Jellyfish\ThankYou\Helper\Data');
$bundleConfigHelper = $this->helper('Magento\Bundle\Helper\Catalog\Product\Configuration');                                                                                                     
$product = $helper->getProductById($_item->getProductId());
$store_id = $generalHelper->getStoreinfo();
$funnelHelper = $this->helper('Jellyfish\CheckoutFunnel\Helper\Data'); 
$options = [];                                                                                                                                                            
if($product->getTypeId()=='bundle'):
  $options = $bundleConfigHelper->getSalesOrderBundleOptions($_item->getItemId());
endif;
?>
<tr>
    <td style="font-size:0;" align="left" valign="top">
        <!--[if (gte mso 9)|(IE)]>
        <table cellpadding="0" cellspacing="0" border="0" role="presentation" style="width: 100%;">
        <tr>
        <td valign="top" style="width: 520px;">
        <![endif]-->
        <div class="w100p" style="display:inline-block;vertical-align:top;width: 70%;">
            <table class="w100p" cellpadding="0" cellspacing="0" border="0" role="presentation" style="width: 360px;">
                <tr>
                    <td align="left" valign="top" class="hs_padded" style="border-collapse:collapse; mso-line-height-rule:exactly; font-family:Helvetica, Arial, sans-serif; font-size:18px; color:#000000; word-break:break-word; padding:16px 20px 4px">
                    <p style="margin: 0;mso-line-height-rule:exactly;font-family: 'Roboto'; font-size:16px; line-height:25px; font-weight: 500; font-style: normal; text-transform: uppercase; color: #2A3D3D;"><?php echo __('Bundle'); ?><span>: </span><span style="margin: 0;mso-line-height-rule:exactly; font-family: 'Roboto'; font-size:16px; line-height:25px; font-weight: 500; font-style: normal; color: #0078FF"><?= $block->escapeHtml($_item->getName()) ?></span></p>
                    </td>
                </tr>
            </table>
        </div>
        <!--[if (gte mso 9)|(IE)]>
        </td><td valign="top" style="width:80px;">
        <![endif]-->
        <div class="w110p" style="display:inline-block;vertical-align:top;width: 30%;">
            <table class="w110p" cellpadding="0" cellspacing="0" border="0" role="presentation" style="width:120px;">
                <tr>
                    <td align="left" valign="top" class="hs_padded" style="border-collapse:collapse; mso-line-height-rule:exactly; font-family:Helvetica, Arial, sans-serif; font-size:18px; color:#000000; word-break:break-word; padding:16px 20px 0px">
                        <p style="margin: 0;mso-line-height-rule:exactly; color: #2A3D3D;font-family: 'Roboto';font-size: 16px;font-style: normal;font-weight: 400;line-height: 25px; text-transform: uppercase;"><?php echo __('Qty'); ?><span>: </span><span style="margin: 0;mso-line-height-rule:exactly; color: #2A3D3D;font-family: 'Roboto';font-size: 16px;font-style: normal;font-weight: 400;line-height: 25px;">x<?= (int) $_item->getQtyOrdered() ?></span></p>
                        
                    </td>
                </tr>
            </table>
        </div>
        <!--[if (gte mso 9)|(IE)]>
        </td>
        </tr>
        </table>
        <![endif]-->
    </td>
</tr>
<!--- Start bundle product loop here -->
<?php foreach($options as $option) {?>
<tr>
    <td style="font-size:0;" align="left" valign="top">
        <!--[if (gte mso 9)|(IE)]>
        <table cellpadding="0" cellspacing="0" border="0" role="presentation" style="width: 100%;">
        <tr>
        <td valign="top" style="width: 520px;">
        <![endif]-->
        <div class="w100p" style="display:inline-block;vertical-align:top;width: 33%;">
            <table class="w100p" cellpadding="0" cellspacing="0" border="0" role="presentation" style="width: 150px;">
                <tr>
                    <td align="left" colspan="2" valign="top" class="hs_padded" style="border-collapse:collapse; mso-line-height-rule:exactly; font-family:Helvetica, Arial, sans-serif; font-size:18px; color:#000000; word-break:break-word; padding:16px 20px 4px">
                        <p style="color: #2A3D3D;font-family: 'Roboto';font-size: 16px;font-style: normal;font-weight: 500;line-height: 25px; ">Product 1</p>
                        <p style="margin: 0;mso-line-height-rule:exactly; color: #2A3D3D;font-family: 'Roboto';font-size: 16px;font-style: normal;font-weight: 400;line-height: 25px;width: 100%;max-width: 100px;"><?= $block->escapeHtml($option['label']) ?>&nbsp;&nbsp;<?= $block->escapeHtml($option['course_level']) ?></p>
                    </td>
                </tr>
            </table>
        </div>
        <!--[if (gte mso 9)|(IE)]>
        <table cellpadding="0" cellspacing="0" border="0" role="presentation" style="width: 100%;">
        <tr>
        <td valign="top" style="width: 300px;">
        <![endif]-->
        <div class="w110p" style="display:inline-block;vertical-align:top;width: 33%;">
            <table class="w110p" cellpadding="0" cellspacing="0" border="0" role="presentation" style="width:130px;">
                <tr>
                    <td align="left" valign="top" class="hs_padded" style="border-collapse:collapse; mso-line-height-rule:exactly; font-family:Helvetica, Arial, sans-serif; font-size:18px; color:#000000; word-break:break-word; padding:16px 20px 4px">
                        <p style="margin: 0;mso-line-height-rule:exactly; color: #2A3D3D;font-family: 'Roboto';font-size: 16px;font-style: normal;font-weight: 500;line-height: 25px;text-transform: uppercase; padding-bottom: 5px;"><?php echo __('Date'); ?></p>
                        <p style="margin: 0;mso-line-height-rule:exactly; color: #2A3D3D;font-family: 'Roboto';font-size: 16px;font-style: normal;font-weight: 400;line-height: 25px;width: 100%;max-width: 100px;"><?php echo $option['course_date']; ?></p>
                    </td>
                </tr>
            </table>
        </div>
        <!--[if (gte mso 9)|(IE)]>
        </td>
        </tr>
        </table>
        <![endif]-->
        <div class="w110p" style="display:inline-block;vertical-align:top;width: 33%;">
            <table class="w110p" cellpadding="0" cellspacing="0" border="0" role="presentation" style="width: 130px;">
                <tr>
                    <td align="left" valign="top" class="hs_padded" style="border-collapse:collapse; mso-line-height-rule:exactly; font-family:Helvetica, Arial, sans-serif; font-size:18px; color:#000000; word-break:break-word; padding:16px 20px 4px">
                        <p style="margin: 0;mso-line-height-rule:exactly; color: #2A3D3D;font-family: 'Roboto';font-size: 16px;font-style: normal;font-weight: 500;line-height: 25px; text-transform: uppercase;padding-bottom: 5px;"><?php echo __('Location'); ?></p>
                        <p style="margin: 0;mso-line-height-rule:exactly; color: #2A3D3D;font-family: 'Roboto';font-size: 16px;font-style: normal;font-weight: 400;line-height: 25px;width: 100%;max-width: 100px;"><?= $block->escapeHtml($option['course_location']) ?></p>
                    </td>
                </tr>
            </table>
        </div>
        <!--[if (gte mso 9)|(IE)]>
        </td><td valign="top" style="width:300px;">
        <![endif]-->
    </td>
</tr>
<tr>
    <td style="font-size:0;" align="center" valign="top" class="hs_padded" style="padding:16px 20px 4px;text-align: center;">
        <div style="height: 1px;background: #979797;margin: 24px 44px 24px 22px;"></div>
    </td>
</tr>
<?php } ?>

<!--- End bundle product loop here -->

<tr>
    <td style="font-size:0;" align="left" valign="top">
        <!--[if (gte mso 9)|(IE)]>
        <table cellpadding="0" cellspacing="0" border="0" role="presentation" style="width: 100%;">
        <tr>
        <td valign="top" style="width: 300px;">
        <![endif]-->
        <div class="w110p" style="display:inline-block;vertical-align:top;">
            <table class="w110p" cellpadding="0" cellspacing="0" border="0" role="presentation" style="width:300px;">
                <tr>
                    <td align="left" valign="top" class="hs_padded" style="border-collapse:collapse; mso-line-height-rule:exactly; font-family:Helvetica, Arial, sans-serif; font-size:18px; color:#000000; word-break:break-word; padding:16px 20px 4px">
                        <p style="margin: 0;mso-line-height-rule:exactly; font-size:14px; line-height:18px; text-transform: uppercase; color: #525252;padding-bottom: 5px;"><?php echo __('Price'); ?><span>: </span><span style="margin: 0;mso-line-height-rule:exactly; font-size:18px; line-height:24px; color: #000000"><?= /* @noEscape */ $block->getItemPrice($_item) ?></span></p>
                        
                    </td>
                </tr>
            </table>
        </div>
        <!--[if (gte mso 9)|(IE)]>
        </td>
        </tr>
        </table>
        <![endif]-->
        <div class="w110p" style="display:inline-block;vertical-align:top;">
            <table class="w110p" cellpadding="0" cellspacing="0" border="0" role="presentation" style="width: 100%;">
                <tr>
                    <td align="left" valign="top" class="hs_padded" style="border-collapse:collapse; mso-line-height-rule:exactly; font-family:Helvetica, Arial, sans-serif; font-size:18px; color:#000000; word-break:break-word; padding:16px 20px 4px">
                        <p style="margin: 0;mso-line-height-rule:exactly; font-size:14px; line-height:18px; text-transform: uppercase; color: #525252;padding-bottom: 5px;"><?php echo __('Attendees'); ?></p>
                        <?php    $participant = $funnelHelper->getParticipant($_order->getId(),$product->getId());                       ?>
                            <?php if(count($participant) > 0){?>
                                <?php foreach($participant as $_participant) {?>
                                    <p style="margin: 0;mso-line-height-rule:exactly; font-size:18px; line-height:24px; color: #000000;width: 100%;max-width: 450px;">
                                        <?php echo strip_tags($_participant->getFirstname(). " " . $_participant->getLastname());?><span> (</span><?php echo strip_tags($_participant->getEmail()); ?><span>)</span>
                                    </p>
                                <?php } ?>
                            <?php } else { ?>
                                    <p style="margin: 0;mso-line-height-rule:exactly; font-size:18px; line-height:24px; color: #000000">N/A</p>
                            <?php } ?>
                    </td>
                </tr>
            </table>
        </div>
        <!--[if (gte mso 9)|(IE)]>
        </td><td valign="top" style="width:300px;">
        <![endif]-->
    </td>
</tr>
<tr>
    <td style="font-size:0;" align="center" valign="top" class="hs_padded" style="padding:16px 20px 4px;text-align: center;">
        <div style="height: 1px;background: #979797;margin: 24px 44px 24px 22px;"></div>
    </td>
</tr>
