<?php
/**
 * Copyright Â© 2013-2017 Magento, Inc. All rights reserved.
 * See COPYING.txt for license details.
 */

// @codingStandardsIgnoreFile

/** @var $block \Magento\Sales\Block\Order\Email\Items\DefaultItems */

/** @var $_item \Magento\Sales\Model\Order\Item */
$_item = $block->getItem();
$_order = $_item->getOrder();
$storeId = $_order->getStoreId();
$generalHelper = $this->helper('Jellyfish\General\Helper\Data');
$courseHelper = $this->helper('Jellyfish\CoursePart\Helper\Data');
$corporateOrderHelper = $this->helper('Jellyfish\CorporateOrder\Helper\Data');
$isCorporateOrder = $_order->getIsCorporateOrder();
$vouchers = $corporateOrderHelper->getVouchers($_order);
if($vouchers) {
    $itemVouchers = isset($vouchers[$_item->getId()]) ? $vouchers[$_item->getId()] : [];
}
?>
<?php $helper = $this->helper('Jellyfish\ThankYou\Helper\Data');?>
<?php $funnelHelper = $this->helper('Jellyfish\CheckoutFunnel\Helper\Data');?>
<?php $tyHelper = $this->helper('Jellyfish\ThankYou\Helper\Data');?>
<?php $product = $helper->getProductById($_item->getProductId(), $storeId); ?>
<?php $level = '';?>
<?php $attributeSetId = $product->getAttributeSetId();?>
<?php if($product->getCourseLevel()){?> 
	<?php $level = $product->getResource()->getAttribute('course_level')->getFrontend()->getValue($product);?>
<?php }else{?>
	<?php if(!$tyHelper->isClassroomCourse($attributeSetId,$_item->getName())){ ?>
		<?php $level = "Online"; ?>
	<?php } ?>
<?php } ?>
<tr>
    <td style="font-size:0;" align="left" valign="top">
        <!--[if (gte mso 9)|(IE)]>
        <table cellpadding="0" cellspacing="0" border="0" role="presentation" style="width: 100%;">
        <tr>
        <td valign="top" style="width: 520px;">
        <![endif]-->
        <div class="w100p" style="display:inline-block;vertical-align:top;">
            <table class="w100p" cellpadding="0" cellspacing="0" border="0" role="presentation" style="width: 520px;">
                <tr>
                    <td align="left" valign="top" class="hs_padded" style="border-collapse:collapse; mso-line-height-rule:exactly; font-family:Helvetica, Arial, sans-serif; font-size:18px; color:#000000; word-break:break-word; padding:16px 20px 4px">
                        <p style="margin: 0;mso-line-height-rule:exactly;font-family: 'Roboto'; font-size:16px; line-height:25px; font-weight: 500; font-style: normal; text-transform: uppercase; color: #2A3D3D;"><?php echo __('Product') ?><span>: </span><span style="margin: 0;mso-line-height-rule:exactly; font-family: 'Roboto'; font-size:16px; line-height:25px; font-weight: 500; font-style: normal; color: #0078FF"><?php echo $block->escapeHtml($_item->getName()).' '. __($level); ?></span></p>  
                    </td>
                </tr>
            </table>
        </div>
        <!--[if (gte mso 9)|(IE)]>
        </td><td valign="top" style="width:80px;">
        <![endif]-->
    </td>
</tr>
<tr>
    <td style="font-size:0;" align="left" valign="top">
        <!--[if (gte mso 9)|(IE)]>
        <table cellpadding="0" cellspacing="0" border="0" role="presentation" style="width: 100%;">
        <tr>
        <td valign="top" style="width: 300px;">
        <![endif]-->
        <?php if($product->getCourseDate()) {?>
        <div class="w110p" style="display:inline-block;vertical-align:top;width: 25%;">
            <table class="w110p" cellpadding="0" cellspacing="0" border="0" role="presentation" style="width:300px;">
                <tr>
                    <td align="left" valign="top" class="hs_padded" style="border-collapse:collapse; mso-line-height-rule:exactly; font-family:Helvetica, Arial, sans-serif; font-size:18px; color:#000000; word-break:break-word; padding:16px 20px 4px">
                        <p style="margin: 0;mso-line-height-rule:exactly; font-family: 'Roboto'; font-size:16px; line-height:25px; font-weight: 500; font-style: normal; color: #2A3D3D; text-transform: uppercase; padding-bottom: 5px;">Date</p>
                        <p style="margin: 0;mso-line-height-rule:exactly; font-family: 'Roboto'; font-size:16px; line-height:25px; font-weight: 400; font-style: normal; color: #2A3D3D;width: 100%;max-width: 55px;"><?php echo $courseHelper->getCourseDate($product); ?></p>
                    </td>
                </tr>
            </table>
        </div>
        <?php } ?>
        <!--[if (gte mso 9)|(IE)]>
        </td>
        </tr>
        </table>
        <![endif]-->
        <div class="w110p" style="display:inline-block;vertical-align:top;width: 15%;">
            <table class="w110p" cellpadding="0" cellspacing="0" border="0" role="presentation" style="width:80px;">
                <tr>
                    <td align="left" valign="top" class="hs_padded" style="border-collapse:collapse; mso-line-height-rule:exactly; font-family:Helvetica, Arial, sans-serif; font-size:18px; color:#000000; word-break:break-word; padding:16px 20px 4px">
                        <p style="margin: 0;mso-line-height-rule:exactly; font-family: 'Roboto'; font-size:16px; line-height:25px; font-weight: 500; font-style: normal; color: #2A3D3D; text-transform: uppercase; "><?php echo __('Qty'); ?></p>
                        <p style="margin: 0;mso-line-height-rule:exactly; font-family: 'Roboto'; font-size:16px; line-height:25px; font-weight: 400; font-style: normal; color: #2A3D3D;">x<?= /* @escapeNotVerified */  $_item->getQtyOrdered() * 1 ?></p>
                    </td>
                </tr>
            </table>
        </div>
        <!--[if (gte mso 9)|(IE)]>
        </td>
        </tr>
        </table>
        <![endif]-->
        <?php if($product->getCourseLocation()) {?>
        <div class="w110p" style="display:inline-block;vertical-align:top;width: 30%;">
            <table class="w110p" cellpadding="0" cellspacing="0" border="0" role="presentation" style="width: 300px;">
                <tr>
                    <td align="left" valign="top" class="hs_padded" style="border-collapse:collapse; mso-line-height-rule:exactly; font-family:Helvetica, Arial, sans-serif; font-size:18px; color:#000000; word-break:break-word; padding:16px 20px 4px">
                        <p style="margin: 0;mso-line-height-rule:exactly; font-family: 'Roboto'; font-size:16px; line-height:25px; font-weight: 500; font-style: normal; color: #2A3D3D; text-transform: uppercase; padding-bottom: 5px;"><?php echo __('Location') ?></p>
                        <p style="margin: 0;mso-line-height-rule:exactly; font-family: 'Roboto'; font-size:16px; line-height:25px; font-weight: 400; font-style: normal; color: #2A3D3D;"><?php echo $product->getResource()->getAttribute('course_location')->getFrontend()->getValue($product); ?></p>
                    </td>
                </tr>
            </table>
        </div>
        <?php } ?>
        <!--[if (gte mso 9)|(IE)]>
        </td><td valign="top" style="width:300px;">
        <![endif]-->
        <!--[if (gte mso 9)|(IE)]>
        <table cellpadding="0" cellspacing="0" border="0" role="presentation" style="width: 100%;">
        <tr>
        <td valign="top" style="width: 300px;">
        <![endif]-->
        <div class="w110p" style="display:inline-block;vertical-align:top;width: 25%">
            <table class="w110p" cellpadding="0" cellspacing="0" border="0" role="presentation" style="width:300px;">
                <tr>
                    <td align="left" valign="top" class="hs_padded" style="border-collapse:collapse; mso-line-height-rule:exactly; font-family:Helvetica, Arial, sans-serif; font-size:18px; color:#000000; word-break:break-word; padding:16px 20px 4px">
                        <p style="margin: 0;mso-line-height-rule:exactly; font-family: 'Roboto'; font-size:16px; line-height:25px; font-weight: 500; font-style: normal; color: #2A3D3D; text-transform: uppercase; ;padding-bottom: 5px;"><?php echo __('Price') ?></p>    
                        <p><span style="margin: 0;mso-line-height-rule:exactly; font-family: 'Roboto'; font-size:16px; line-height:25px; font-weight: 400; font-style: normal; color: #2A3D3D;"><?= /* @escapeNotVerified */  $generalHelper->getFormatedPrice($_item->getRowTotal(), 2); ?></span></p>
                    </td>
                </tr>
            </table>
        </div>
        <!--[if (gte mso 9)|(IE)]>
        </td><td valign="top" style="width:300px;">
        <![endif]-->
    </td>
</tr>
<tr>
    <td style="font-size:0;" align="left" valign="top">
    
        <div class="w110p" style="display:inline-block;vertical-align:top;width: 100%;">
            <table class="w110p" cellpadding="0" cellspacing="0" border="0" role="presentation" style="width: 500px;">
                <tr>
                    <td align="left" valign="top" class="hs_padded" style="border-collapse:collapse; mso-line-height-rule:exactly; font-family:Helvetica, Arial, sans-serif; font-size:18px; color:#000000; word-break:break-word; padding:16px 20px 4px">
                        <p style="margin: 0;mso-line-height-rule:exactly; font-family: 'Roboto'; font-size:16px; line-height:25px; font-weight: 500; font-style: normal; color: #2A3D3D; text-transform: uppercase; ;padding-bottom: 5px;"><?php echo !$isCorporateOrder ? __('Attendees') : __('Voucher(s)') ; ?></p>
                        <?php if(!$isCorporateOrder) { 
                            $participant = $funnelHelper->getParticipant($_order->getId(),$product->getId());
                            ?>
                            <?php if(count($participant) > 0){?>
                                <?php foreach($participant as $_participant) {?>
                                    <p style="margin: 0;mso-line-height-rule:exactly; font-family: 'Roboto'; font-size:16px; line-height:25px; font-weight: 400; font-style: normal; color: #2A3D3D;width: 100%;max-width: 500px;">
                                        <?php echo strip_tags($_participant->getFirstname(). " " . $_participant->getLastname());?><span> (</span><?php echo strip_tags($_participant->getEmail()); ?><span>)</span>
                                        
                                    </p>
                                <?php } ?>
                            <?php } else { ?>
                                    <p style="margin: 0;mso-line-height-rule:exactly; font-size:18px; line-height:24px; color: #000000">N/A</p>
                            <?php } ?>
                        <?php } else { ?>
                            <?php if(!empty($itemVouchers)) { 
                                    foreach($itemVouchers as $voucher) { ?>
                                <p style="margin: 0;mso-line-height-rule:exactly; font-size:18px; line-height:24px; color: #000000">
                                    <?php echo strip_tags($voucher['voucher_code']);?>     
                                </p>
                                <?php } ?>    
                            <?php } ?>
                        <?php } ?>
                    </td>
                </tr>
            </table>
        </div>
        <!--[if (gte mso 9)|(IE)]>
        </td>
        </tr>
        </table>
        <![endif]-->
    </td>
</tr>


<tr>
    <td style="font-size:0;" align="center" valign="top" class="hs_padded" style="padding:16px 20px 4px;text-align: center;">
        <div style="height: 1px;background: #979797;margin: 24px 44px 24px 22px;"></div>
    </td>
</tr>




